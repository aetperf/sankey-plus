<!DOCTYPE html>
<html>

<head>

  <script src="https://d3js.org/d3.v7.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

  <link href="https://fonts.googleapis.com/css?family=Roboto:100i" rel="stylesheet">

  <title>Sankey with circular links</title>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }

    rect {
      shape-rendering: crispEdges;
    }

    text {
      font-size: 12px;
      font-family: monospace;
    }

    .link {
      fill: none;
    }

    #chart {
      padding: 10px
    }
  </style>
</head>

<body>

  <h1>Sankey with benefits</h1>
  <div id="chart"></div>

  <script type="module">

    import { SankeyChart } from '../src/sankeyPlus.js';

    let div = d3.select("#chart");


    let testData = {
      nodes: [
        { name: 'landingC' },
        { name: 'landingA' },
        { name: 'landingB' },
        { name: 'A' },
        { name: 'B' },
        { name: 'C' },
        { name: 'D' },
        { name: 'E' },
        { name: 'F' },
        { name: 'G' },
        { name: 'H' },
        { name: 'I' }
      ],
      links: [
        { source: 'landingA', target: 'A', value: 1 },
        { source: 'landingB', target: 'B', value: 10 },
        { source: 'landingC', target: 'C', value: 5 },
        { source: 'landingC', target: 'D', value: 100 },
        { source: 'D', target: 'I', value: 1 },
        { source: 'C', target: 'E', value: 15 },
        { source: 'A', target: 'F', value: 8 },
        { source: 'B', target: 'G', value: 8 },
        { source: 'E', target: 'H', value: 8 }
      ]
    }



    let nodes = [
      { name: "startA" },
      { name: "startB" },
      { name: "process1" },
      { name: "process2" },
      { name: "process3" },
      { name: "process4" },
      { name: "process5" },
      { name: "process6" },
      { name: "process7" },
      { name: "process8" },
      { name: "process9" },
      { name: "process10" },
      { name: "process11" },
      { name: "process12" },
      { name: "process13" },
      { name: "process14" },
      { name: "process15" },
      { name: "process16" },
      { name: "finishA" },
      { name: "finishB" }
    ];


    let links = [
      { source: "startA", target: "process8", value: 20, optimal: "yes" },
      { source: "startA", target: "process5", value: 20, optimal: "yes" },
      { source: "startA", target: "process6", value: 20, optimal: "yes" },
      { source: "startB", target: "process1", value: 15, optimal: "yes" },
      { source: "startB", target: "process5", value: 15, optimal: "yes" },
      { source: "process1", target: "process4", value: 30, optimal: "yes" },
      { source: "process4", target: "process1", value: 10, optimal: "yes" },
      { source: "process2", target: "process7", value: 35, optimal: "yes" },
      { source: "process1", target: "process3", value: 20, optimal: "yes" },
      { source: "process5", target: "process1", value: 20, optimal: "yes" },
      { source: "process6", target: "startA", value: 5, optimal: "yes" },
      { source: "process4", target: "process2", value: 10, optimal: "yes" },
      { source: "process6", target: "process8", value: 15, optimal: "yes" },
      //{ "source": "process4", "target": "startB", "value": 5, "optimal": "yes" },
      { source: "process3", target: "process2", value: 15, optimal: "yes" },
      //{ "source": "process3", "target": "startB", "value": 5, "optimal": "yes" },
      { source: "process15", target: "process13", value: 10, optimal: "yes" },
      { source: "process13", target: "process9", value: 10, optimal: "yes" },
      { source: "process7", target: "startB", value: 20, optimal: "yes" },
      { source: "process8", target: "process1", value: 10, optimal: "yes" },
      { source: "process8", target: "process16", value: 10, optimal: "yes" },
      { source: "process16", target: "process9", value: 10, optimal: "yes" },
      { source: "process8", target: "process11", value: 25, optimal: "yes" },
      { source: "process11", target: "process10", value: 20, optimal: "yes" },
      { source: "process4", target: "process12", value: 10, optimal: "yes" },
      { source: "process12", target: "process11", value: 10, optimal: "yes" },
      { source: "process7", target: "process15", value: 15, optimal: "yes" },
      { source: "process15", target: "process14", value: 10, optimal: "yes" },
      { source: "process10", target: "process13", value: 10, optimal: "yes" },
      { source: "process10", target: "process16", value: 10, optimal: "yes" },
      { source: "process14", target: "finishB", value: 10, optimal: "yes" },
      { source: "process9", target: "finishA", value: 10, optimal: "yes" },
      { source: "process16", target: "process8", value: 10, optimal: "yes" },
      { source: "process9", target: "finishB", value: 10, optimal: "yes" },
      { source: "process15", target: "finishB", value: 10, optimal: "yes" },
      { source: "process15", target: "finishA", value: 10, optimal: "yes" },
      { source: "process11", target: "process15", value: 25, optimal: "yes" },
      { source: "process11", target: "process11", value: 5, optimal: "yes" },
      { source: "finishA", target: "finishA", value: 15, optimal: "yes" },
      { source: "finishB", target: "finishB", value: 15, optimal: "yes" },
      { source: "process5", target: "process5", value: 10, optimal: "yes" },
      { source: "finishB", target: "process14", value: 5, optimal: "yes" }
    ];

    //set the nodes and links data (mandatory)
    //override the defaults
    const sankeyConfig = {
      align: "left",
      id: d => d.name,
      iterations: 10,
      extent: [[0, 0,], [1, 1]],
      padding: 25,
      width: 900,
      height: 500,
      useManualScale: false,
      nodes: {
        //data: testData.nodes,
        data: nodes,
        width: 10,
        //maxHeight: 75,
        scaleDomain: [0, 100],
        scaleRange: [0, 75],
        padding: 25,
        minPadding: 25,
        virtualPadding: 7,
        sort: null,
        setPositions: false
      },
      links: {
        //data: testData.links,
        data: links,
        circularGap: 5,
        circularLinkPortionTopBottom: 0.4,
        circularLinkPortionLeftRight: 0.1,
        useVirtualRoutes: true,
        baseRadius: 10,
        verticalMargin: 25,
        opacity: 0.5,
        virtualLinkType: "both"  // ["both", "bezier", "virtual"]
      },
      arrows: {
        enabled: true,
        color: 'DarkSlateGrey',
        length: 10,
        gap: 25,
        headSize: 4
      }

    };


    console.log(sankeyConfig.width);

    let chart = new SankeyChart(div, sankeyConfig);

    console.log(chart);

    chart.redraw();




  </script>

</body>

</html>